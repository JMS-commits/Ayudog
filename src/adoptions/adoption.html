<!DOCTYPE html>
<html>

<head>
	<title>Parcel Sandbox</title>
    <meta charset="UTF-8" />
    <link rel="shortcut icon" href="../../img/favicon.png" >
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/normalize.css">
    <link rel="stylesheet" href="../../css/style.css">
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="../../js/jquery-3.3.1.min.js" charset="utf-8"></script>
    <script src="../../js/popper.min.js" charset="utf-8"></script>
    <script src="../../js/bootstrap.min.js" charset="utf-8"></script>
    <script src="../../js/fontawesome-all.js" charset="utf-8"></script>
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
</head>

<body >
	<!-- Firebase App is always required and must be first -->
	<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-storage.js"> </script>
	<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-database.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-firestore.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-messaging.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-functions.js"></script>
	<!-- Inicializa o firebase -->
	<script>
		var firebaseConfig = {
            apiKey: "AIzaSyA5VKKM9a6EBaXLGvLRyjCLS5-KA3c4r4w",
            authDomain: "notificationtest-6d60f.firebaseapp.com",
            databaseURL: "https://notificationtest-6d60f.firebaseio.com",
            projectId: "notificationtest-6d60f",
            storageBucket: "notificationtest-6d60f.appspot.com",
            messagingSenderId: "577427666180",
            appId: "1:577427666180:web:e0a7a52517085658eccc51",
            measurementId: "G-8E25M7K4V5"
        };
          firebase.initializeApp(firebaseConfig);

        $(document).ready(function(){
            console.log(sessionStorage);
            if(sessionStorage.length>0){
                if(sessionStorage.access != null || sessionStorage.access != "" || sessionStorage.access != " "){
                    console.log("Entra al if");
                    readUserData();
                    $("#database").click(function(){
                        var fileInput = $("#file-input")[0].files[0].name;
                        var title = $("#title").val();
                        var subtitle = $("#subtitle").val();
                        var description = $("#description").val();
                        writeUserData(title, subtitle, description, fileInput);
                        
                    });

                    
                    $("#logout").click(function(){
                        firebase.auth().signOut().then(function() {
                        // Sign-out successful.
                        console.log("Sign-out successful");
                        sessionStorage.clear();
                        location.href = "http://localhost/Ayudog/src/session";
                        
                        }).catch(function(error) {
                        // An error happened.
                        console.log("error> "+error);

                        });
                    });
                    $("#title").change(function(){
                        var title = $("#title").val();
                        console.log(title);
                        $("#txtTitle").html(`<h5 class="font3 color-txt" style="font-size:2.85vh" >`+title+`</h5>`);
                    });
                    $("#subtitle").change(function(){
                        var title = $("#subtitle").val();
                        console.log(title);
                        $("#txtSubtitle").html(title);
                    });
                    $("#description").change(function(){
                        var title = $("#description").val();
                        console.log(title);
                        $("#txtDesc").html(title);
                    });
                    
                    $("#access").click(function(){
                        alert(sessionStorage.access);
                        console.log(sessionStorage.access);
                    });

                    $("#delete").click(function(){
                        sessionStorage.removeItem("access");
                    });

                    $("#adoption").on("click","#borrar", function(){
                        var key = $(this).data("id");
                        var image = $(this).data("src");
                        var ref = firebase.storage().ref("prueba/");
                        var tangRef = ref.child(image);
                        tangRef.delete().then(function() {
                            firebase.database().ref('/adoption/'+key).remove()
                            readUserData()
                        }).catch(function(error) {
                            alert("Ha ocurrido un error intente más tarder")
                        });
                        
                    })
                }else{
                    location.href = "http://localhost/Ayudog/";
                }
            }else{
                location.href = "http://localhost/Ayudog/";
            }
            
        });

        function writeUserData(title, subtitle, description, image) {
            firebase.database().ref('adoption/').push({
                title: title,
                subtitle: subtitle,
                description: description,
                image : image
            }).then((res) => {
                alert("Informacion guardada con exito");
                setFile();
            });
        }
        function readUserData() {
            var cad = "";
            firebase.database().ref('/adoption/').once('value').then(async function(snapshot) {
                for(var key in snapshot.val()){
                    var item = snapshot.val()[key];
                    var image;
                    var ref = firebase.storage().ref("prueba/");
                    var tangRef = ref.child(item.image);
                    image = await tangRef.getDownloadURL()

                    
                    console.log(image);
                    cad+= '<div class="card col-3"><a id="borrar" data-id="'+key+'" data-src="'+item.image+'"><i class="fas fa-times-circle text-dang"></i></a><div class="view view-cascade overlay"><img class="card-img-top" src="'+image+'" alt="Card image cap"><a href="#!"><div class="mask rgba-white-slight"></div></a></div><div class="card-body card-body-cascade text-center"><h4 class="card-title text-dang"><strong>'+item.title+'</strong></h4><p class="card-text">'+item.description+'</p><h5 class="blue-text pb-2"><strong>Contactanos por Mina</strong></h5><a class="px-2 fa-lg text-whatsapp"><i class="fab fa-whatsapp text-whatsapp" style="color: #00E676;"></i></a><a class="px-2 fa-lg fb-ic"><i class="fab fa-facebook-f text-facebook" style="color: #4267B2;"></i></a></div></div>'
                    //console.log("snapshot.val.title = " + snapshot.val()[key].title);
                    //console.log("snapshot.val" + snapshot.val()[key]);
                    //nextUrl = snapshot.val()[key].url;
                }
                $("#adoption").html(cad);
            });
        }
    </script>
    <nav class="navbar navbar-expand-lg navbar-dark bg-hue fixed-top">
        <div class="container">
            <a class="navbar-brand px-lg-4 mr-0 d-lg-none" href="#">
            <img src="../../img/favicon.png" height="70" alt="">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#basicExampleNav" aria-controls="basicExampleNav"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-center font-weight-bold" id="basicExampleNav">
                <ul class="navbar-nav">
                    <li class="nav-item font3">
                        <a class="nav-link" data-toggle="modal" data-target="#basicExampleModal">
                            <div class="esp">
                                <i class="fa fa-plus-circle" aria-hidden="true"></i> Agregar Nuevo
                            </div>
                        </a>
                </ul>
                
                <a class="navbar-brand px-lg-4 mr-0 d-none d-lg-block">
                    <img src="../../img/favicon.png" height="70" alt="">
                </a>
                <ul class="navbar-nav">
                    
                    </li>
                    <li class="nav-item font3">
                        <a class="nav-link" id="logout">
                            <div class="esp">
                                <i class="fa fa-sign-out-alt" aria-hidden="true"></i> Cerrar Sesión
                            </div>
                        </a>
                    </li>                
                </ul>
            </div>
        </div>
    </nav>

	<div id="app"></div>

    <div id="render" class="container" style="padding-top: 8%;">
        <div class="row" id="adoption">
            
        </div>
        
            <!-- Nosso app -->
        <div class="container-fluid d-none">
              
            <section class="" style="padding-top:10px">
                <div class="container-fluid">
                <div class="d-none d-lg-block">
                    <div class="parallax-window" data-parallax="scroll" data-image-src="img/n14.jpg" style="background:rgba(21,21,21,0.2)">
                    <div class="col-md-6 col-sm-12 col-12">
                        <img src="../../img/crecimiento perros.png" class="img-fluid container" width="" alt="Responsive image">
                        <!--img src="img/esteri.png" class="img-fluid container" width="" alt="Responsive image"-->
                    </div>
                    </div>
                </div>
                <div class="d-none d-block d-lg-none container">
                    <img src="../../img/crecimiento perros.png" class="img-fluid" width="" alt="Responsive image">
                    <!--img src="img/esteri.png" class="img-fluid" width="" alt="Responsive image"-->
                </div>
            </section>
            
            <section class="testimonial color-txt" id="sec-2" style="background:#414141">
                <div class="">
                    <div class="esp">
                    <h1 class="font3" >Adoptame</h1>
                    </div>
                    <div class="ing d-none">
                        <h1 class="font3" >Myths, true or false</h1>
                    </div>
                </div>
            </section>

            <section class="d-none d-lg-block">
                <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div id="mdb-lightbox-ui"></div>
                        <div class=" row mdb-lightbox no-margin">
                            
                            <figure class="col-md-6 col-lg-6 col-sm-6 col-6 cardBox">
                                <div class="card">
                                    <img class="card-img-top" src="../../img/perros22.jpg" alt="Card image cap">
                                </div>
                                </figure>
                                
                                <figure class="col-md-6 col-lg-6 col-sm-6 col-6 card2" >
                                    <div class="card-body front text-justify">
                                    <div class="d-none d-md-block d-print-block">
                                        <p class="card-text ">
                                        <div class="esp" id="">
                                            <h5 class="font3 color-txt" style="font-size:2.85vh">LA ESTERILIZACIÓN, SÓLO DEBE SER EN PERROS Y GATOS CALLEJEROS.</h5>
                                            <h5 class="font7 text-dang" style="font-size:2.85vh">FALSO: <span class="font2 color-txt" style="font-size:2.85vh">La fábrica de perros y gatos, están en las casas de dueños que no
                                            esterilizan a sus animales.<br> Muchos dueños permiten que sus animales
                                            salgan de casa solos y es ahí cuando frecuentemente se cruzan. <br> Otro problema muy real y cruel, es que muchos compran un cachorro adorable,
                                            no se le educa y se convierte en un adulto problemático y en el 90% de los casos son abandonados. <br>Esto es lo más inhumano que existe y en su
                                            mayoria, NO están esterilizados.</span></h5>
                                        </div>
                                        <div class="ing d-none" id="">
                                            <h5 class="font3 color-txt" style="font-size:2.85vh">NEUTERING SHOULD ONLY BE DONE ON STREET DOGS AND CATS</h5>
                                            <h5 class="font7 text-dang" style="font-size:2.85vh">FALSE: <span class="font2 color-txt" style="font-size:2.85vh">The main dog and cat factories are in the houses of the owners who don't
                                            neuter their pets. <br>Many owners allow their dogs to go out on their own, and that is when they frequently mate.<br> Another cruel but common problem is that
                                            many buy a lovely puppy, which later becomes a problematic adult and in many cases they are abandoned.<br>This is the most inhumane thing and worst of all,
                                            they are most likely not neutered.</span></h5>
                                        </div>
                                        </p>
                                    </div>
                                    </div>
                                    <div class="card-body back text-justify">
                                    <div class="d-none d-md-block d-print-block">
                                        <div class="esp" id="">
                                        <p class="card-text " style="padding-top:20%">
                                            <h4 class="font color-txt text-justify">
                                            Los perros son los únicos mamíferos que realmente mirarán fijamente a los a un ser humano.
                                            </h4>
                                        </p>
                                        <p class="card-text ">
                                            <h5 class="font color-txt text-center">Jerry O'Conell</h5>
                                        </p>
                                        </div>
                                        <div class="ing d-none" id="">
                                        <p class="card-text  " style="padding-top:20%"> <h4 class="text-white font">Dogs are the only mammals that will actually
                                            stare and look into human's eyes.</h4>
                                        </p>
                                        <p class="card-text ">
                                            <h5 class="text-white font text-center">Jerry O'Conell</h5>
                                        </p>
                                        </div>
                                    </div>
                                    </div>
                                </figure>
                    
                                <figure class="col-md-6 col-lg-6 col-sm-6 col-6 cardBox2">
                                <div class="card">
                                    <img class="card-img-top" src="../../img/gatos1.jpeg" alt="Card image cap">
                                </div>
                                </figure>

                        </div>
                    </div>
                </div>
                </div>
            </section>
                
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="basicExampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Agregar Post</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <div class="modal-body">
                <div class="col-12">
                    <div class="row p-3">
                        <div class="offset-1 col-5">
                            <label for="basic-url">Titulo</label>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="title" aria-describedby="basic-addon3">
                            </div>
                        </div>
                        <div class="col-5">
                            <label for="basic-url">Subtitulo</label>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="subtitle" aria-describedby="basic-addon3">
                            </div>
                        </div>
                        <div class="offset-1 col-10">
                            <label for="basic-url">Imagen</label>
                            <div class="input-group mb-3">
                                <input type="file" id="file-input" class="form-control" aria-describedby="basic-addon3">
                            </div>
                        </div>
                        <div class="offset-1 col-10">
                            <div class="form-group green-border-focus">
                                <label for="basic-url">Descripción</label>
                                <textarea id="description" class="form-control" id="exampleFormControlTextarea5" rows="3"></textarea>
                            </div>
                        </div>

                        
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="col-12">
                    <button id="database" type="button" class="btn btn-primary btn-block">Aceptar</button>
                </div>
            </div>
        </div>
    </div>
    </div>
<!-- Modal -->
	<script src="./app.js">
    </script>
</body>

</html>